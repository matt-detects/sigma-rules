title: Suspicious PowerShell Execution with Encoded Command
id: 9c1e5c0a-4e8b-4f4f-9b9a-encoded-ps-demo
status: experimental
description: |
  Detects PowerShell execution with the -EncodedCommand parameter, 
  which is commonly used to obfuscate malicious payloads.

author: Matt S
date: 2026-02-12
references:
  - https://attack.mitre.org/techniques/T1059/001/
  - https://www.sans.org/blog/understanding-powershell-obfuscation/
tags:
  - attack.execution
  - attack.t1059.001
  - attack.defense_evasion

logsource:
  category: process_creation
  product: windows

detection:
  selection_process:
    Image|endswith: '\powershell.exe'

  selection_encoded:
    CommandLine|contains:
      - '-EncodedCommand'
      - '-enc '
  
  filter_known_admin:
    User|contains:
      - 'svc_'
      - 'admin'

  condition: selection_process and selection_encoded and not filter_known_admin

fields:
  - Image
  - CommandLine
  - ParentImage
  - User
  - Hostname

falsepositives:
  - Legitimate administrative scripts using encoded commands
  - Software deployment tools
  - Automation frameworks

level: medium
